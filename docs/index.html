<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Stormpath  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-29159574-1', 'auto');
        ga('send', 'pageview');

    </script>
  </head>
  <body>
    <a title="Stormpath  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Stormpath Docs</a> (100% documented)</p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Stormpath Reference</a>
        <img id="carat" src="img/carat.png" />
        Stormpath  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Account.html">Account</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RegistrationModel.html">RegistrationModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Stormpath.html">Stormpath</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StormpathConfiguration.html">StormpathConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StormpathError.html">StormpathError</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StormpathSocialProviderConfiguration.html">StormpathSocialProviderConfiguration</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/AccountStatus.html">AccountStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/StormpathSocialProvider.html">StormpathSocialProvider</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Typealiases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:9Stormpath24StormpathAccountCallback">StormpathAccountCallback</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:9Stormpath24StormpathSuccessCallback">StormpathSuccessCallback</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <a href='#stormpath_ios_sdk' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='stormpath_ios_sdk'>Stormpath iOS SDK</h1>

<p><a href="http://cocoapods.org/pods/Stormpath"><img src="https://img.shields.io/cocoapods/v/Stormpath.svg?style=flat" alt="CocoaPods Compatible"></a>
<a href="https://github.com/stormpath/stormpath-sdk-swift"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a>
<a href="http://cocoapods.org/pods/Stormpath"><img src="https://img.shields.io/cocoapods/l/Stormpath.svg?style=flat" alt="License"></a>
<a href="https://codebeat.co/projects/github-com-stormpath-stormpath-sdk-swift"><img src="https://codebeat.co/badges/0038aa1f-d481-4ad0-a244-3a6d803c3dbe" alt="codebeat badge"></a></p>

<p>The iOS Library for <a href="https://stormpath.com/">Stormpath</a>, a framework for authentication &amp; authorization. </p>
<a href='#requirements' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='requirements'>Requirements</h1>

<p>iOS 8.0+ / Xcode 7.1+</p>
<a href='#set_up' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='set_up'>Set up</h1>

<p>Stormpath&rsquo;s iOS SDK allows developers utilizing Stormpath to quickly integrate authentication and token management into their app. </p>

<p>This SDK will not send direct requests to Stormpath, and instead assumes that you&rsquo;ll have a backend that conforms to the <a href="https://github.com/stormpath/stormpath-framework-spec">Stormpath Framework Spec</a>. With one of these backends, you&rsquo;ll be able to configure Stormpath so it fits your needs. </p>

<p>We&rsquo;re constantly iterating and improving the SDK, so please don&rsquo;t hesitate to send us your feedback! You can reach us via <a href="mailto:support@stormpath.com">support@stormpath.com</a>, or on the issue tracker for feature requests. </p>
<a href='#setting_up_a_compatible_backend' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='setting_up_a_compatible_backend'>Setting up a Compatible Backend</h2>

<p>Stormpath&rsquo;s framework integrations plug into popular web frameworks and expose pre-built API endpoints that you can customize. The two backends that are currently compatible with the iOS SDK are: <a href="https://github.com/stormpath/express-stormpath">express-stormpath</a> (v3.0) and <a href="https://github.com/stormpath/stormpath-laravel">stormpath-laravel</a> (v0.3). </p>

<p>If you&rsquo;re just testing, it&rsquo;s pretty quick to set up a server using the <a href="https://github.com/stormpath/express-stormpath-sample-project">express sample project</a>. </p>
<a href='#installation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='installation'>Installation</h1>
<a href='#cocoapods' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='cocoapods'>CocoaPods</h2>

<p>Stormpath is available through <a href="https://cocoapods.org/">CocoaPods</a>. Add this line to your <code>Podfile</code> to begin:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'Stormpath'</span><span class="p">,</span> <span class="s1">'~&gt; 1.2'</span>
</code></pre>

<p>Don&rsquo;t forget to uncomment use_frameworks! as well:</p>
<pre class="highlight ruby"><code><span class="n">use_frameworks!</span>
</code></pre>
<a href='#carthage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='carthage'>Carthage</h2>

<p>To use Stormpath with <a href="https://github.com/Carthage/Carthage">Carthage</a>, specify it in your <code>Cartfile</code>:</p>
<pre class="highlight plaintext"><code>github "stormpath/stormpath-sdk-swift" ~&gt; 1.2
</code></pre>
<a href='#usage' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='usage'>Usage</h1>

<p>To see the SDK in action, you can try downloading the <a href="https://github.com/stormpath/stormpath-ios-example">Stormpath iOS Example</a> project. We&rsquo;ve built the same app twice, once in Objective-C and another time in Swift so you can see how to use the SDK. </p>
<a href='#importing_the_framework' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='importing_the_framework'>Importing the framework</h2>

<p>For Swift projects:</p>
<pre class="highlight plaintext"><code>import Stormpath
</code></pre>

<p>For Objective-C projects: </p>
<pre class="highlight plaintext"><code>#import "Stormpath-Swift.h"
</code></pre>
<a href='#setting_up_the_api_endpoints' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='setting_up_the_api_endpoints'>Setting up the API Endpoints</h2>

<p>Stormpath&rsquo;s default configuration will attempt to connect to <code>http://localhost:3000/</code>. This is the default configuration for the <code>express-stormpath</code> integration and is useful when you&rsquo;re testing in the iOS simulator. However, you&rsquo;ll need to modify this for any other setups. </p>

<p>Swift:</p>
<pre class="highlight plaintext"><code>StormpathConfiguration.defaultConfiguration.APIURL = NSURL(string: "http://localhost:3000")!
</code></pre>

<p>Objective-C:</p>
<pre class="highlight plaintext"><code>[StormpathConfiguration defaultConfiguration].APIURL = [[NSURL alloc] initWithString:@"http://localhost:3000"];
</code></pre>

<p><em>Note: As of the iOS 9 SDK, Apple has enabled App Transport Security by default. If you&rsquo;re developing against an <code>http</code> endpoint, you&rsquo;ll need to disable it. For production, you should always be using <code>https</code> for your API endpoints.</em></p>
<a href='#user_registration' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='user_registration'>User registration</h2>

<p>In order to register a user, instantiate a <code>RegistrationModel</code> object. By default, Stormpath framework integrations require an <code>email</code>, <code>password</code>, <code>givenName</code>, and <code>surname</code>. </p>
<pre class="highlight plaintext"><code>let account = RegistrationModel(email: "user@example.com", password: "ExamplePassword")
account.givenName = "Example"
account.surname = "McExample"
</code></pre>

<p>Then, just invoke the register method on <code>Stormpath</code> class:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.register(account) { (account, error) -&gt; Void in
    guard let account = account where error == nil else {
        //The account registration failed
        return
    }
    // Do something with the returned account object, such as save its `href` if needed. 
    // Registering a user will not automatically log them in. 
}
</code></pre>

<p><em>Note: Stormpath callbacks always happen on the main thread, so you can make UI changes directly in the callback.</em></p>
<a href='#logging_in' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='logging_in'>Logging in</h2>

<p>To log in, collect the email (or username) and password from the user, and then pass them to the login method:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login("user@example.com", password: "ExamplePassword") { (success, error) -&gt; Void in
    guard error == nil else {
        // We could not authenticate the user with the given credentials. Handle the error. 
        return
    }
    // The user is now logged in, and you can use the Stormpath access token to make API requests!
}
</code></pre>
<a href='#logging_in_with_facebook_or_google' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='logging_in_with_facebook_or_google'>Logging in with Facebook or Google</h2>

<p>Stormpath also supports logging in with Facebook or Google. There are two flows for enabling this:</p>

<ol>
<li>Let Stormpath handle the Facebook / Google Login.</li>
<li>Use the Facebook / Google iOS SDK to get an access token, and pass it to Stormpath to log in.</li>
</ol>

<p>We&rsquo;ve made it extremely easy to set up social login without using the Facebook / Google SDK, but if you need to use their SDKs for more features besides logging in, you should use flow #2 (and skip directly to <q>Advanced ____ Login</q>). </p>
<a href='#setting_up_your_appdelegate' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='setting_up_your_appdelegate'>Setting up your AppDelegate</h3>

<p>In your Xcode project, add the following methods to your <code>AppDelegate</code>:</p>
<pre class="highlight plaintext"><code>// Only needed for iOS 9
func application(app: UIApplication, openURL url: NSURL, options: [String : AnyObject]) -&gt; Bool {
    return Stormpath.sharedSession.application(app, openURL: url, options: options)
}

func application(application: UIApplication, openURL url: NSURL, sourceApplication: String?, annotation: AnyObject) -&gt; Bool {
    return Stormpath.sharedSession.application(application, openURL: url, sourceApplication: sourceApplication, annotation: annotation)
}
</code></pre>
<a href='#setting_up_facebook_login' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='setting_up_facebook_login'>Setting up Facebook Login</h3>

<p>To get started, you first need to <a href="https://developers.facebook.com/?advanced_app_create=true">register an application</a> with Facebook. After registering your app, go into your app dashboard&rsquo;s settings page. Click <q>Add Platform</q>, and fill in your Bundle ID, and turn <q>Single Sign On</q> on. </p>

<p>Then, <a href="https://api.stormpath.com/login">sign into Stormpath</a> and add a Facebook directory to your account. Fill the App ID and Secret with the values given to you in the Facebook app dashboard. Then, add the directory to your Stormpath application. </p>

<p>Finally, open up your App&rsquo;s Xcode project and go to the project&rsquo;s info tab. Under <q>URL Types</q>, add a new entry, and in the URL schemes form field, type in <code>fb[APP_ID_HERE]</code>, replacing <code>[APP_ID_HERE]</code> with your Facebook App ID. </p>

<p>Then, you can initiate the login screen by calling: </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login(socialProvider: .Facebook) { (success, error) -&gt; Void in
    // This callback is the same as the regular Stormpath.login callback. 
    // If the user cancels the login, the login was never started, and
    // this callback will not be called.
}
</code></pre>
<a href='#setting_up_google_login' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='setting_up_google_login'>Setting up Google Login</h3>

<p>To get started, you first need to <a href="https://console.developers.google.com/project">register an application</a> with Google. Click <q>Enable and Manage APIs</q>, and then the credentials tab. Create two sets of OAuth Client IDs, one as <q>Web Application</q>, and one as <q>iOS</q>. </p>

<p>Then, <a href="https://api.stormpath.com/login">sign into Stormpath</a> and add a Google directory to your account. Fill in the Client ID and Secret with the values given to you for the web client. (You can fill in <q>Google Authorized Redirect URI</q> with <code>http://YOURSERVER/callbacks/google</code>. Then, add the directory to your Stormpath application. </p>

<p>Finally, open up your App&rsquo;s Xcode project and go to the project&rsquo;s info tab. Under <q>URL Types</q>, add a new entry, and in the URL schemes form field, type in your Google iOS Client&rsquo;s <code>iOS URL scheme</code> from the Google Developer Console. </p>

<p>Then, you can initiate the login screen by calling: </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login(socialProvider: .Google) { (success, error) -&gt; Void in
    // Same callback as above
}
</code></pre>
<a href='#using_the_google_or_facebook_sdk' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='using_the_google_or_facebook_sdk'>Using the Google or Facebook SDK</h3>

<p>If you&rsquo;re using the <a href="https://developers.facebook.com/docs/facebook-login/ios">Facebook SDK</a> or <a href="https://developers.google.com/identity/sign-in/ios/">Google SDK</a> for your app, follow their setup instructions instead. Once you successfully sign in with their SDK, utilize the following methods to send your access token to Stormpath, and log in your user: </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.login(socialProvider: .Facebook, accessToken: FBSDKAccessToken.currentAccessToken().tokenString) { (success, error) -&gt; Void in
    // Same callback as above
}

Stormpath.sharedSession.login(socialProvider: .Google, accessToken: GIDSignIn.sharedInstance().currentUser.authentication.accessToken) { (success, error) -&gt; Void in
    // Same callback as above
}
</code></pre>
<a href='#using_the_access_token' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='using_the_access_token'>Using the Access Token</h2>

<p>You can utilize the access token to access any of your API endpoints that require authentication. It&rsquo;s stored as a property on the Stormpath object as <code>Stormpath.sharedSession.accessToken</code>. If you need to refresh it, use <code>Stormpath.sharedSession.refreshAccessToken()</code>. Depending on the networking library you&rsquo;re using, here&rsquo;s how you&rsquo;d use the access token:</p>
<a href='#nsurlsession' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='nsurlsession'>NSURLSession</h3>
<pre class="highlight plaintext"><code>let request = NSMutableURLRequest(URL: url)
request.setValue("Bearer " + accessToken, forHTTPHeaderField: "Authorization")
</code></pre>
<a href='#alamofire' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='alamofire'>Alamofire</h3>
<pre class="highlight plaintext"><code>let headers = ["Authorization": "Bearer " + accessToken]
Alamofire.request(.GET, url, headers: headers)
</code></pre>
<a href='#account_data' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='account_data'>Account data</h2>

<p>Stormpath&rsquo;s framework integrations provide a default endpoint for retrieving profile information. Fetch the account data by using me:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.me { (account, error) -&gt; Void in
    guard let account = account where error == nil else {
        // We might not be logged in, the API is misconfigured, the API is down, etc
        return
    }
    // Success! We have the account object.
}
</code></pre>
<a href='#logout' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='logout'>Logout</h2>

<p>Logging out is simple. This will delete the access token and refresh token from the user&rsquo;s device, and make an API request to delete from the server. </p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.logout()
</code></pre>
<a href='#password_reset' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='password_reset'>Password reset</h2>

<p>To reset a user&rsquo;s password, you&rsquo;ll need to collect their email first. Then simply pass that email to the <code>resetPassword</code> function like so:</p>
<pre class="highlight plaintext"><code>Stormpath.sharedSession.resetPassword("user@example.com") { (success, error) -&gt; Void in
    guard error == nil else {
        // A network or API problem occurred. 
        return
    }
    // We succeeded in making the API request. 
}
</code></pre>
<a href='#error_handling' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='error_handling'>Error handling</h2>

<p>When using Stormpath, you can encounter errors for several reasons: </p>

<ol>
<li>Network errors - the network request failed for some reason.</li>
<li>User errors - errors because of user input, ex: <q>invalid username or password</q>.</li>
<li>API errors - the API is misconfigured, or returning an unrecognized response.</li>
</ol>

<p>If there&rsquo;s a network error, Stormpath will return the <code>NSError</code> associated with <code>NSURLSession</code> to your code. Otherwise, Stormpath will return <code>StormpathError</code>, a <code>NSError</code> subclass. </p>

<p>For user errors, <code>StormpathError</code> will have the HTTP error code of the API response (usually 400), and <code>localizedDescription</code> set to a user-readable error message which is safe to display to the user. </p>

<p>In special cases, StormpathError will have code 0 or 1. These are developer errors that should not be displayed to the user. 0 stands for <q>Stormpath SDK Error</q>, and most likely indicates a bug with the Stormpath SDK that should be reported to us. 1 stands for <q>API Response Error</q>, and means that the API responded with something unexpected. This most likely means that you have your backend integration misconfigured. </p>
<a href='#custom_configuration' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='custom_configuration'>Custom configuration</h2>

<p><code>StormpathConfiguration</code> can be used to point Stormpath to a specific API URL, as well as custom endpoints. While you can modify the object directly, you can also put your configuration in Info.plist. To add the Stormpath configuration, right click on Info.plist, and click <q>open as source code</q>. Before the last <code>&lt;/plist&gt;</code> tag, paste: </p>
<pre class="highlight xml"><code><span class="nt">&lt;key&gt;</span>Stormpath<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>APIURL<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>http://localhost:3000<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>customEndpoints<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;dict&gt;</span>
        <span class="nt">&lt;key&gt;</span>me<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/me<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>verifyEmail<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/verify<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>forgotPassword<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/forgot<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>oauth<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/oauth/token<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>logout<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/logout<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>register<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/register<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
</code></pre>

<p>You can modify any of these values, and <code>StormpathConfiguration</code> will load these on first initialization. </p>
<a href='#handling_multiple_sessions' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='handling_multiple_sessions'>Handling Multiple Sessions</h2>

<p>Stormpath can be used to store multiple user accounts, even against multiple API servers using Stormpath. This is useful if you&rsquo;re making a multi-tenant application that allows the user to be logged in under different accounts at the same time. </p>

<p>To use this feature, instead of using <code>Stormpath.sharedSession</code>, initialize Stormpath with a custom identifier:</p>
<pre class="highlight plaintext"><code>Stormpath(identifier: "newSession")
</code></pre>

<p>This will create an instance of Stormpath with the default configuration (shared with the rest of the app) that will store <code>accessTokens</code> and <code>refreshTokens</code> in its own partition in the iOS Keychain. </p>

<p>This identifier can be used in your app to identify a user session contained in Stormpath, and properly restore it in between app opens. </p>

<p><em>Note: the identifier for <code>Stormpath.sharedSession</code> is <q>default</q>, so do not use this as an identifier for another instance of Stormpath.</em></p>
<a href='#license' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='license'>License</h1>

<p>This project is open-source via <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. See the LICENSE file for details.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2016 <a class="link" href="https://github.com/stormpath/stormpath-sdk-ios" target="_blank" rel="external">Stormpath</a>. All rights reserved. (Last updated: 2016-03-10)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.5.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
